package com.example.demo.services;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.example.demo.models.Billetera;
import com.example.demo.models.Divisa;
import com.example.demo.models.SaldoDivisa;
import com.example.demo.models.Usuario;
import com.example.demo.repositries.BilleteraRepository;
import com.example.demo.repositries.SaldoDivisaRepository;

@Service
public class BilleteraServiceImpl implements BilleteraService {

	@Autowired
	BilleteraRepository repository;

	@Autowired
	SaldoDivisaRepository saldoRepository;

	@Autowired
	UsuarioService usuarioService;

	@Autowired
	DivisaService divisaService;

	@Override
	public List<Billetera> getBilleteras() {
		return repository.findAll();
	}

	@Override
	public List<Billetera> getBilleteraByUserId(Long userId) {
		return repository.findByUserId(userId);
	}

	@Override
	public Billetera getBilleteraById(Long billeteraId) {
		Optional<Billetera> billetera = repository.findById(billeteraId);
		if (!billetera.isEmpty())
			return billetera.get();
		else
			return null;
	}

	@Override
	public Billetera registrarBilletera(Long userId) {
		Usuario usuario = usuarioService.getUsuarioById(userId);
		if (usuario != null) {
			Billetera nueva = new Billetera(0, 0, usuario);
			nueva = repository.save(nueva);
			List<Divisa> divisas = divisaService.getDivisas();
			List<SaldoDivisa> saldos = new ArrayList<SaldoDivisa>();
			SaldoDivisa saldo;
			for (int i = 0; i < divisas.size(); i++) {
				SaldoDivisa addDivisa = new SaldoDivisa(divisas.get(i).getDivisaTipo(), nueva);
				saldo = saldoRepository.save(addDivisa);
				saldos.add(saldo);
			}
			nueva.setSaldoDivisa(saldos);
			return nueva;
		}
		return null;
	}

	@Override
	public void update(Billetera billetera) {
		if (!repository.findById(billetera.getBilleteraId()).isEmpty())
			repository.save(billetera);
	}

}
